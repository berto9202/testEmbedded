<h1>Let’s start chatting...</h1>
<br />
Click the button to start a chat.
<br />
<!-- Embedded Service Snippet -->
<!-- Los últimas dos reglas de estilo fueron añadidas por clarcat, no obstante, podéis modificar lo que sea necesario -->
<style type="text/css">
    .embeddedServiceHelpButton .helpButton .uiButton {
        background-color: #005290;
        font-family: "Arial", sans-serif;
    }
    .embeddedServiceHelpButton .helpButton .uiButton:focus {
        outline: 1px solid #005290;
    }
    .embeddedServiceHelpButton .uiButton {
        max-width: 25em;
    }
    .embeddedServiceSidebarMinimizedDefaultUI {
        min-width: 22em !important;
    }
</style>

<script
    type="text/javascript"
    src="https://service.force.com/embeddedservice/5.0/esw.min.js"
></script>
<script type="text/javascript">
    var initESW = function (gslbBaseURL) {
        embedded_svc.settings.displayHelpButton = true; //Or false
        embedded_svc.settings.language = "es"; //For example, enter 'en' or 'en-US'

        embedded_svc.settings.defaultMinimizedText = "Chatear con un experto"; //(Defaults to Chat with an Expert)
        embedded_svc.settings.disabledMinimizedText =
            "Ningún agente disponible"; //(Defaults to Agent Offline)

        embedded_svc.settings.loadingText = "Cargando"; //(Defaults to Loading)
        //embedded_svc.settings.storageDomain = 'yourdomain.com'; //(Sets the domain for your deployment so that visitors can navigate subdomains during a chat session)

        // Settings for Chat
        //embedded_svc.settings.directToButtonRouting = function(prechatFormData) {
        // Dynamically changes the button ID based on what the visitor enters in the pre-chat form.
        // Returns a valid button ID.
        //};

        // AÑADIDO POR CLARCAT
        embedded_svc.settings.prepopulatedPrechatFields = {
            FirstName: "Alberto",
            LastName: "Miranda Riesgo",
            Email: "berto9202@gmail.com",
        };
        // sin los valores de los campos especificados, el formulario sale vacío!
        //Los valores anteriores son un ejemplo de uso, puedes ser modificados como se necesite!
        // Cuando un usuario esté logueado dentro de Merkal, Merkal mandará la información necesaria a completar en lo anterior!

        //embedded_svc.settings.fallbackRouting = []; //An array of button IDs, user IDs, or userId_buttonId
        //embedded_svc.settings.offlineSupportMinimizedText = '...'; //(Defaults to Contact Us)

        embedded_svc.settings.enabledFeatures = ["LiveAgent"];
        embedded_svc.settings.entryFeature = "LiveAgent";

        //console.log(embedded_svc.settings.initialInteractionState); // undefined aunque by default debería ser PRECHAT
        //console.log(embedded_svc.settings.prepopulatedPrechatFields);

        /*if (embedded_svc.settings.prepopulatedPrechatFields.Email === "") {
                console.log("PRECHAT")
                embedded_svc.settings.initialInteractionState = "PRECHAT";
            } else {
                console.log("WAITING");
                embedded_svc.settings.initialInteractionState = "WAITING";
            }*/

        embedded_svc.settings.extraPrechatFormDetails = [
            {
                label: "RecordTypeId",
                value: "0127Q000000LiYAQA0",
                displayToAgent: false,
            },
        ];

        embedded_svc.settings.extraPrechatInfo = [
            {
                entityName: "Contact",
                saveToTranscript: "ContactId",
                showOnCreate: true,
                entityFieldMaps: [
                    {
                        fieldName: "FirstName",
                        doCreate: false,
                        doFind: false,
                        label: "Nombre",
                    },
                    {
                        fieldName: "LastName",
                        doCreate: false,
                        doFind: false,
                        label: "Apellidos",
                    },
                    {
                        fieldName: "Email",
                        doFind: true,
                        doCreate: false,
                        label: "Correo electrónico",
                    },
                ],
            },
            {
                entityName: "Account",
                showOnCreate: true,
                saveToTranscript: "AccountId",
                entityFieldMaps: [
                    {
                        isExactMatch: false,
                        fieldName: "FirstName",
                        doCreate: true,
                        doFind: false,
                        label: "Nombre",
                    },
                    {
                        isExactMatch: false,
                        fieldName: "LastName",
                        doCreate: true,
                        doFind: false,
                        label: "Apellidos",
                    },
                    {
                        isExactMatch: false,
                        fieldName: "RecordTypeId",
                        doCreate: true,
                        doFind: false,
                        label: "RecordTypeId",
                    },
                    {
                        fieldName: "PersonEmail",
                        doCreate: true,
                        doFind: true,
                        label: "Correo electrónico",
                    },
                ],
            },
        ];

        embedded_svc.init(
            "https://merkalsf.my.salesforce.com",
            "https://merkal16022022.secure.force.com/liveAgentSetupFlow",
            gslbBaseURL,
            "00D7Q000000IkAr",
            "chat_Agents",
            {
                baseLiveAgentContentURL:
                    "https://c.la2-c1-fra.salesforceliveagent.com/content",
                deploymentId: "5727Q000000H3Pb",
                buttonId: "5737Q000000H3dR",
                baseLiveAgentURL:
                    "https://d.la2-c1-fra.salesforceliveagent.com/chat",
                eswLiveAgentDevName: "chat_Agents",
                isOfflineSupportEnabled: false,
            }
        );
    };

    if (!window.embedded_svc) {
        var s = document.createElement("script");
        s.setAttribute(
            "src",
            "https://merkalsf.my.salesforce.com/embeddedservice/5.0/esw.min.js"
        );
        s.onload = function () {
            initESW(null);
        };
        document.body.appendChild(s);
    } else {
        initESW("https://service.force.com");
    }
</script>
